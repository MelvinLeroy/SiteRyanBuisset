!function(e,t,a,s){function i(){this.opts=e.extend(o,ylc.defaults),this.premium=e.extend({},_)}var n="ylc_console",r="plugin_"+n,o={app_id:"",user_info:{user_id:null,user_name:null,user_email:null,gravatar:null,user_type:null,avatar_type:null,avatar_image:null,current_page:null,user_ip:null}},_={};i.prototype={init:function(){this.data={auth:null,ref:null,is_mobile:!1,active_user_id:0,mode:"offline",logged:!1,assets_url:ylc.plugin_url,user:{},online_ops:{}},this.strings=ylc.strings,this.sounds={},this.objs={last_cnv_id:null,last_user_id:null,last_msg_id:null,right_sidebar_html:"",list_interval:null,working:!1,checked_user_ids:[],new_msgs_count:{}};var t=this;e("#YLC_connect").click(function(a){a.preventDefault(),e("#YLC_notify").show().html(t.strings.msg.connecting+"..."),e(this).data("logged")?e(this).data("status","online")&&t.be_offline():t.login(!0)}),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(this.data.is_mobile=!0),this.post("ylc_ajax_callback","get_token",{},function(e){e.error||(t.data.auth_token=e.token,t.check_ntf(),t.auth())})},auth:function(e){return this.opts.app_id?(null==this.data.ref&&(this.data.ref=new Firebase("https://"+this.opts.app_id+".firebaseIO.com"),this.data.ref_conn=new Firebase("https://"+this.opts.app_id+".firebaseIO.com/.info/connected"),this.data.ref_cnv=new Firebase("https://"+this.opts.app_id+".firebaseIO.com/chat_sessions"),this.data.ref_msgs=new Firebase("https://"+this.opts.app_id+".firebaseIO.com/chat_messages"),this.data.ref_users=new Firebase("https://"+this.opts.app_id+".firebaseIO.com/chat_users")),this.login(!1,e),void this.after_load()):void console.error("App ID not provided")},after_load:function(){var s=this;e(a).on("keydown","#YLC_cnv_reply",function(){e(this).trigger("autosize.resize"),e(t).trigger("resize")}),e(a).on("focus","#YLC_cnv_reply",function(){e(this).autosize({append:""})}),e(a).on("click","#YLC_users li.free, #YLC_users li.busy",function(){var a=e(this);null!=s.objs.list_interval&&clearInterval(s.objs.list_interval),s.get_user_data(e(this).data("id"),function(i){s.data.active_user_id&&e("#YLC_chat_user_"+s.data.active_user_id).removeClass("chat-active"),a.addClass("chat-active").removeClass("new-msg").data("count",0).find(".chat-count").empty(),e("#YLC_popup_cnv").removeClass("chat-welcome"),e("#YLC_cnv_reply").val("").focus().removeAttr("disabled"),e(".chat-cnv-input").removeClass("chat-disabled"),e(".sidebar-info.info-name span").html(i.user_name),e(".sidebar-info.info-ip span").html(i.user_ip),e(".sidebar-info.info-email a").html(i.user_email).attr("href","mailto:"+i.user_email),e(".sidebar-info.info-page a").html(i.current_page?i.current_page:"N/A").attr("href",i.current_page?i.current_page:"#"),e("#YLC_end_chat").attr("data-cnv-id",a.data("cnv-id")),e("#YLC_save").attr("data-cnv-id",a.data("cnv-id")),e("#YLC_active_cnv").val(a.data("cnv-id")),s.objs.cnv=e("#YLC_cnv"),s.objs.cnv.html(""),s.data.user.conversation_id=a.data("cnv-id"),s.data.active_user_id=a.data("id"),s.reload_cnv(a.data("cnv-id")),s.manage_reply_box(s.objs.last_cnv_id),s.objs.last_cnv_id=a.data("cnv-id"),s.objs.cnv.show(),e("#YLC_cnv_bottom .user-avatar img").attr("src",s.set_avatar(s.data.user.user_type,{gravatar:s.data.user.gravatar,avatar_type:s.data.user.avatar_type,avatar_image:s.data.user.avatar_image})),e("#YLC_cnv_bottom").show(),e("#YLC_sidebar_right").show(),"free"==a.data("chat")?s.data.ref_users.child(a.data("id")).child("chat_with").set(s.data.user.user_id):a.data("chat")==s.data.user.user_id?e("#YLC_end_chat").show():e("#YLC_end_chat").hide(),s.trigger_premium("show_chat_timer",a.data("cnv-id")),e(t).trigger("resize")})}),e(a).on("click","#YLC_save, #YLC_end_chat",function(t){var a=e(this),i=e("#YLC_save_ntf"),n="YLC_end_chat"===e(this).attr("id"),r=new Date,o=r.getTime();return i.show(),s.objs.working?void i.html(s.strings.msg.please_wait+"..."):(s.objs.working=!0,e(this).addClass("button-disabled"),i.html(s.strings.msg.saving+"..."),n&&null!=s.objs.list_interval&&clearInterval(s.objs.list_interval),void(ylc.is_premium?s.trigger_premium("end_chat_console",e("#YLC_active_cnv").val(),n,o,a,i):s.clear_user_data(e("#YLC_active_cnv").val(),function(){s.objs.working=!1,a.removeClass("button-disabled"),setTimeout(function(){i.fadeOut(500)},100),setTimeout(function(){s.show_welcome_popup()},1e3)})))}),this.trigger_premium("premium_console"),e("#YLC_popup_cnv").mouseover(function(){e("#YLC_chat_user_"+s.data.active_user_id).removeClass("new-msg").data("count",0).find(".chat-count").empty()}),setInterval(function(){e(".chat-last-online").each(function(t){e(this).html(s.timeago(e(this).data("time")))})},6e4);var i=0;setInterval(function(){var t=0;s.data.ref_users.once("value",function(a){var s=a.val();null!==s&&e.each(s,function(e,a){a&&"wait"===a.status&&(t+=1)})}),i=t,t>0?e("#YLC_queue").html(s.strings.msg.waiting_users.replace(/%d/i,t)).show():e("#YLC_queue").hide()},15e3),t.onbeforeunload=function(e){var a=e||t.event;return a&&(a.returnValue=s.strings.msg.ntf_close_console),s.strings.msg.ntf_close_console}},login:function(t,a){var s=this;this.manage_connections(),this.data._new_user=t,this.data.auth=this.data.ref.authWithCustomToken(this.data.auth_token,function(t){t?(console.error(t.code,t.message),e("#YLC_connect").removeClass("button-disabled"),e("#YLC_notify").hide().html(t.message).fadeIn(200),s.display_ntf(s.strings.msg.conn_err,"error")):(e("#YLC_notify").html(s.strings.msg.you_offline),e("#YLC_connect").html(s.strings.msg.connect).data("logged",0).removeClass("button-disabled"),s.data.logged=!0,s.data.ref_users.once("value",function(t){var i=t.val(),n=0;if(null!==i){var r=Object.keys(i).length;e.each(i,function(e,t){n++,t&&"operator"==t.user_type&&"online"===t.status&&(s.data.online_ops[t.user_id]=t),n===r&&(s.data.mode="offline",s.check_user(s.opts.user_info.user_id))})}else s.data.mode="offline",s.check_user(s.opts.user_info.user_id);a&&a()}))})},logged_in:function(t){var a=this;a.trigger_premium("play_sound","connected"),a.listen_msgs(),e("#YLC_notify").hide().empty(),e("#YLC_connect").html('<i class="fa fa-check-circle" style="color:#acc327;"></i> '+a.strings.msg.online_btn).data("logged",1).data("status","online").removeClass("button-disabled"),a.purge_firebase()},logout:function(a){var s=this;this.data.user.user_id&&(s.data.ref_user.off(),s.data.ref_users.off(),s.data.ref_msgs.off(),s.trigger_premium("play_sound","offline"),e("#YLC_notify").html(s.strings.msg.you_offline),e("#YLC_connect").html(s.strings.msg.connect).data("logged",0).data("status","offline").removeClass("button-disabled"),s.show_welcome_popup()),e(t).trigger("resize"),s.offline()},be_offline:function(){this.data.mode="offline",this.data.ref_user&&(this.data.ref_user.child("status").set("offline"),this.data.ref_user.child("last_online").set(Firebase.ServerValue.TIMESTAMP)),this.offline()},offline:function(){var t=this;t.trigger_premium("play_sound","disconnected"),e("#YLC_notify").html(t.strings.msg.you_offline),e("#YLC_connect").html('<i class="fa fa-check-circle" style="color:#e54045;"></i> '+t.strings.msg.offline_btn).data("logged",0).data("status","offline").removeClass("button-disabled")},check_user:function(e){var t=this;this.data.ref_user=this.data.ref_users.child(e),this.data.ref_user.once("value",function(a){var s=a.val();s||(s={}),t.get_user(e,s)}),this.data.ref_user.child("chat_with").on("value",function(e){var a=e.val();null!=a&&(t.data.user.chat_with=a)}),this.data.ref_users.on("child_removed",function(a){var s=a.val();s&&e===s.user_id&&t.logout()})},get_user:function(e,t,a){var s=this;if(t.user_id)this.data.user=t,this.data.ref_user.child("status").set("offline"),this.data.ref_user.child("user_ip").set(this.opts.user_info.user_ip),this.data.ref_user.child("current_page").set(this.opts.user_info.current_page),this.data.ref_user.child("user_name").set(this.opts.user_info.user_name),this.data.ref_user.child("user_email").set(this.opts.user_info.user_email),this.data.ref_user.child("gravatar").set(this.opts.user_info.gravatar),this.data.ref_user.child("avatar_type").set(this.opts.user_info.avatar_type),this.data.ref_user.child("avatar_image").set(this.opts.user_info.avatar_image),this.data.ref_user.child("vendor_id").set(ylc.active_vendor.vendor_id),this.data.ref_user.child("vendor_name").set(ylc.active_vendor.vendor_name),this.data.mode="offline",this.manage_connections(),this.logged_in(this.data.user),this.listen_users(),a&&a();else if(this.data._new_user===!0){var i=this.data.ref_cnv.push({user_id:e,created_at:Firebase.ServerValue.TIMESTAMP,accepted_at:"",evaluation:"",user_type:"operator",receive_copy:!1}),n={user_id:e,conversation_id:i.key(),last_online:"",is_mobile:this.data.is_mobile,chat_with:"free",status:"online",vendor_id:ylc.active_vendor.vendor_id,vendor_name:ylc.active_vendor.vendor_name};for(var r in this.opts.user_info)n[r]=this.opts.user_info[r];this.data.user=n,this.data.ref_user.set(n,function(e){e||(s.data.mode="online",s.logged_in(s.data.user),s.manage_connections(),s.listen_users()),a&&a()})}else this.listen_users()},listen_users:function(){var t=this;this.data.last_changed_id=null,e("#YLC_users > ul").remove(),e("#YLC_users").append("<ul></ul>"),this.data.user_list=e("#YLC_users > ul"),this.data.ref_users.once("value",function(a){var s=a.val(),i=0;if(null!==s){var n=Object.keys(s).length;t.data.online_ops={},e.each(s,function(a,s){i+=1,s&&t.valid_operator(s.vendor_id)&&("operator"===s.user_type&&("online"===s.status?t.data.online_ops[s.user_id]=s:delete t.data.online_ops[s.user_id]),t.add_user_item(s)),i===n&&t.data.ref_users.on("value",function(a){e("#YLC_users > ul").empty();var s=a.val();e.each(s,function(e,a){t.valid_operator(a.vendor_id)&&t.update_user(a)})})})}})},update_user:function(t,a){(!t||t.user_id)&&(t&&(t.conversation_id?(this.add_user_item(t),"operator"===t.user_type&&("online"===t.status?this.data.online_ops[t.user_id]=t:delete this.data.online_ops[t.user_id]),a||-1==e.inArray(t.user_id,this.objs.checked_user_ids)&&t.user_id!=this.data.user.user_id&&(this.trigger_premium("play_sound","online"),"operator"!=t.user_type&&this.notify(this.strings.msg.new_user_online,t.user_name+" ("+t.user_type+")",null,"user_online"),this.objs.checked_user_ids.push(t.user_id)),this.data.active_user_id===t.user_id&&e("#YLC_active_page").attr("href",t.current_page).find("span").html(t.current_page)):this.clean_user_data(t.user_id)),this.data.last_changed_id=a)},clean_user_data:function(t){var a=this,s=this.data.ref_users.child(t);s.once("value",function(i){var n=i.val();s.remove(),n.conversation_id&&a.ref_cnv.child(n.conversation_id),a.data.ref_msgs.once("value",function(s){var i=s.val();i&&e.each(i,function(e,s){s.user_id===t&&a.data.ref_msgs.child(e).remove()})})})},add_user_item:function(a){if(a.user_id&&this.data.user_list){var s="",i=!1,n="#YLC_chat_user_"+a.user_id;"free"!=a.chat_with&&(null==this.data.online_ops[a.chat_with]?(this.data.ref_users.child(a.user_id).child("chat_with").set("free"),i=!1):(i=a.chat_with!=this.data.user.user_id,s=this.data.online_ops[a.chat_with].user_name));var r=i?" busy":" free",o="offline"===a.status||"wait"===a.status?' - <span class="other-info" data-time="'+a.last_online+'">'+this.timeago(a.last_online)+"</span>":"",_=i?'<br /><span class="other-info">'+this.strings.msg.talking_label.replace(/%s/i,s)+"</span>":"",c="";"operator"==a.user_type&&(r=" op"),ylc.yith_wpv_active&&"0"==ylc.active_vendor.vendor_id&&(c=0==a.vendor_id?"":this.strings.msg.current_shop.replace(/%s/i,a.vendor_name)+" "),e(n).remove();var d=a.user_name||a.user_email||"N/A",u="user-"+a.status+" user-"+a.user_type+r,l=this.set_avatar(a.user_type,{gravatar:a.gravatar,avatar_type:a.avatar_type,avatar_image:a.avatar_image}),h=a.is_mobile?'<i class="fa fa-mobile"></i>':"",v=c+a.user_type+o+_;this.data.user_list.append('<li id="YLC_chat_user_'+a.user_id+'" data-id="'+a.user_id+'" data-cnv-id="'+a.conversation_id+'" data-name="'+d+'" data-count="0" data-chat="'+a.chat_with+'" class="'+u+'"><div class="user-avatar"><img src="'+l+'" /></div><i class="fa fa-check-circle"></i>'+h+'<div class="chat-username">'+d+'<span class="chat-count"></span></div><div class="chat-meta">'+v+"</div></li>");var f=e(n);if(a.user_id==this.data.active_user_id)f.addClass("chat-active").removeClass("new-msg").data("count",0).find(".chat-count").empty(),null!=this.objs.new_msgs_count[a.user_id]&&(this.objs.new_msgs_count[a.user_id]=0);else{var m=null!=this.objs.new_msgs_count[a.user_id]?this.objs.new_msgs_count[a.user_id]:0;m>0&&f.data("count",m).find(".chat-count").html("("+m+")")}e(t).trigger("resize")}},notify:function(e,a,s,i){if(Notification&&"Notification"in t)if("granted"===Notification.permission){var n=new Notification(e,{body:a,icon:ylc.plugin_url+"/images/ylc-ico.png",tag:i});s?n.onclick=function(){s()}:n.close(),setTimeout(function(){n.close()},4e3)}else"denied"!==Notification.permission&&Notification.requestPermission(function(t){if("permission"in Notification||(Notification.permission=t),"granted"===t){var i=new Notification(e,{body:a});s?i.onclick=function(){s()}:i.close(),setTimeout(function(){i.close()},4e3)}})},set_avatar:function(e,t){return e="operator"==e?"admin":"user",ylc.is_premium?this.trigger_premium("set_avatar_premium",e,t):this.data.assets_url+"/images/default-avatar-"+e+".png"},time:function(e,t){return this.strings.time[e]&&this.strings.time[e].replace(/%d/i,Math.abs(Math.round(t)))},timeago:function(e){if(!e)return"";var t=new Date,a=.001*(t.getTime()-e)>>0,s=a/60,i=s/60,n=i/24,r=n/365;return(45>a&&this.time("seconds",a)||90>a&&this.time("minute",1)||45>s&&this.time("minutes",s)||90>s&&this.time("hour",1)||24>i&&this.time("hours",i)||42>i&&this.time("day",1)||30>n&&this.time("days",n)||45>n&&this.time("month",1)||365>n&&this.time("months",n/30)||1.5>r&&this.time("year",1)||this.time("years",r))+" "+this.strings.time.suffix},listen_msgs:function(){var t=this;this.data.ref_msgs.off(),this.data.ref_msgs.once("value",function(a){var s=a.val(),i=s?Object.keys(s).length:0,n=1;s?e.each(s,function(e,a){a.first_load=!0,t.new_msg(a),i==n&&t.listen_new_msgs(e),n+=1}):t.listen_new_msgs()})},new_msg:function(t,a){var s=this;if(s.valid_operator(t.vendor_id)){var i=e("#YLC_chat_user_"+t.user_id),n=i.find(".chat-count"),r=parseInt(i.data("count"));0!=t.read||t.user_id==s.data.user.user_id||a||(r+=1,s.objs.new_msgs_count[t.user_id]=r,i.addClass("new-msg").data("count",r),n.html("("+r+")"),s.trigger_premium("play_sound","new-msg"),s.notify(s.strings.msg.new_msg,t.user_name+": "+t.msg,null,"new_msg")),s.data.user.conversation_id==t.conversation_id&&(e("#YLC_load_msg").remove(),s.add_msg(t,s.objs.last_user_id,s.objs.last_msg_id),s.objs.last_user_id=t.user_id,s.objs.last_user_id==t.user_id&&s.objs.last_msg_id||(s.objs.last_msg_id=t.msg_id)),a&&s.data.ref_msgs.child(a).child("read").set(!0)}},listen_new_msgs:function(e){var t=this,a=e?t.data.ref_msgs.startAt(null,e):t.data.ref_msgs,s=!0;e||(s=!1),a.on("child_added",function(e){var a=e.val();a.id=e.key(),t.new_msg(a),s=!1})},add_msg:function(e,t,a){var s=new Date,i=new Date(e.msg_time),n=i.getHours()+":"+(i.getMinutes()<10?"0":"")+i.getMinutes(),r=this.sanitize_msg(e.msg),o=i.toDateString()==s.toDateString()?n:i.getUTCDate()+" "+this.strings.months_short[i.getUTCMonth()]+", "+n;if(this.objs.cnv){var _=e.user_id==this.data.user.user_id?" chat-you":"",c=i.getUTCDate()+" "+this.strings.months[i.getUTCMonth()]+" "+i.getUTCFullYear()+" "+n,d=this.set_avatar(e.user_type,{gravatar:e.gravatar,avatar_type:e.avatar_type,avatar_image:e.avatar_image});this.objs.cnv.append('<div id="YLC_msg_'+e.id+'" class="chat-cnv-line'+_+'"><div title="'+c+'" class="chat-cnv-time">'+o+'</div><div class="chat-avatar"><img src="'+d+'" /></div> <div class="chat-cnv-msg"><div class="chat-cnv-author">'+e.user_name+"</div>"+r+'</div> </div><div class="chat-clear"></div>').scrollTop(this.objs.cnv.prop("scrollHeight"))}},sanitize_msg:function(e){var t,a,s,i,n,r={"&":"&amp;","<":"&lt;",">":"&gt;"};return t=e.replace(/[&<>]/g,function(e){return r[e]||e}),n=/\n/gim,t=t.replace(n,"<br />"),a=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,t=t.replace(a,'<a href="$1" target="_blank">$1</a>'),s=/(^|[^\/])(www\.[\S]+(\b|$))/gim,t=t.replace(s,'$1<a href="http://$2" target="_blank">$2</a>'),i=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim,t=t.replace(i,'<a href="mailto:$1">$1</a>')},manage_reply_box:function(t){var a=this,s=!1,i=e("#YLC_cnv_reply"),n=function(){var e=0;return function(t,a){clearTimeout(e),e=setTimeout(t,a)}}();this.data.ref_cnv.child(this.data.user.conversation_id+"/typing").remove(),i.keydown(function(t){if(13!==t.keyCode||t.shiftKey){if(!s){switch(t.keyCode){case 17:case 18:case 16:case 9:case 8:case 224:case 17:case 91:case 93:return}a.data.ref_cnv.child(a.data.user.conversation_id+"/typing/"+a.data.user.user_id).set(a.data.user.user_name),s=!0}n(function(){a.data.ref_cnv.child(a.data.user.conversation_id+"/typing/"+a.data.user.user_id).remove(),s=!1},1300)}else{t.preventDefault();var i=e(this).val();i&&(e(this).val("").trigger("autosize.resize"),a.push_msg(i),a.data.ref_cnv.child(a.data.user.conversation_id+"/typing/"+a.data.user.user_id).remove())}}),t&&(this.data.ref_cnv.child(t+"/typing").off(),this.data.ref_cnv.child(t).off("child_added")),this.data.ref_cnv.child(this.data.user.conversation_id+"/typing").on("value",function(t){var s=0,i=t.val(),n=i?Object.keys(i).length:0;return i?void e.each(i,function(e,t){return null!=e&&e!=a.data.user.user_id?void a.display_ntf(a.strings.msg.writing.replace(/%s/i,t),"typing"):(n===s&&a.clean_ntf(),void(s+=1))}):void a.clean_ntf()}),this.data.ref_cnv.child(this.data.user.conversation_id).on("child_added",function(t){"closed"==t.val()&&(e("#YLC_cnv_reply").attr("disabled","disabled"),e(".chat-cnv-input").addClass("chat-disabled"))})},reload_cnv:function(t){var a=this;this.data.ref_msgs.once("value",function(s){var i=(new Date,s.val()),n=i?Object.keys(i).length:0,r=0,o=1;i?e.each(i,function(e,s){s.conversation_id==t&&(a.new_msg(s,e),r+=1),n==o&&a.cnv_msgs_loaded(r),o+=1}):a.cnv_msgs_loaded(0)})},cnv_msgs_loaded:function(t){t?e("#YLC_load_msg").empty():e("#YLC_load_msg").html(this.strings.msg.no_msg+".")},push_msg:function(e){this.data.ref_msgs.push({user_id:this.data.user.user_id,user_type:this.data.user.user_type,conversation_id:this.data.user.conversation_id,user_name:this.data.user.user_name||this.data.user.user_email,gravatar:this.data.user.gravatar,avatar_type:this.data.user.avatar_type,avatar_image:this.data.user.avatar_image,msg:e,msg_time:Firebase.ServerValue.TIMESTAMP,vendor_id:ylc.active_vendor.vendor_id,read:!0})},get_user_data:function(e,t){this.data.ref_users.child(e).once("value",function(e){var a=e.val();t(a)})},manage_connections:function(){var t=this;this.data.ref_user&&this.data.ref_conn.on("value",function(a){if(a.val()===!0){e("#YLC_firebase_offline").hide();var s=t.data.ref_user.child("connections").push(!0);s.onDisconnect().remove(),t.data.ref_user.child("status").set("online"),t.data.ref_user.child("status").onDisconnect().set("offline"),t.data.ref_user.child("last_online").onDisconnect().set(Firebase.ServerValue.TIMESTAMP),t.data.ref_cnv.child(t.data.user.conversation_id+"/typing/"+t.data.user.user_id).onDisconnect().remove()}else e("#YLC_firebase_offline").show()})},post:function(t,a,s,i){e.post(ylc.ajax_url+"?action="+t+"&mode="+a,s,i,"json").fail(function(e){return console.log(a,": ",e),!1})},trigger_premium:function(e,t,a,s,i,n,r){return ylc.is_premium?this.premium[e].call(this,t,a,s,i,n,r):void 0},check_ntf:function(){"Notification"in t&&"denied"!==Notification.permission&&Notification.requestPermission(function(e){"permission"in Notification||(Notification.permission=e)})},display_ntf:function(t,a){var s;switch(a){case"success":s='<i class="fa fa-check"></i> ';break;case"error":s='<i class="fa fa-exclamation-triangle"></i> ';break;case"typing":s='<i class="fa fa-pencil-square-o"></i> ';break;default:s=""}e("#YLC_popup_ntf").removeClass().addClass("chat-ntf chat-"+a).html(s+t).fadeIn(300)},clean_ntf:function(){e("#YLC_popup_ntf").html("").hide()},clear_user_data:function(t,a){var s=this;this.data.ref_cnv.child(t).once("value",function(i){var n=i.val();if(n){var r=n.user_id;s.data.ref_msgs.once("value",function(i){var n=i.val(),o=n?Object.keys(n).length:0,_=0;n?e.each(n,function(e,i){_+=1,i.conversation_id===t&&s.data.ref_msgs.child(e).remove(),o===_&&a&&a()}):a&&a(),s.data.ref_users.child(r).remove(),s.data.ref_cnv.child(t).remove()})}})},total_online_ops:function(){return this.data.online_ops?Object.keys(this.data.online_ops).length:0},purge_firebase:function(t){var a=this;this.data.ref_users.once("value",function(s){var i=s.val(),n=0,r=[],o=[],_=[],c=t?0:3600;if(null!==i){var d=Object.keys(i).length,u=new Date;e.each(i,function(t,s){if(n++,s&&"offline"===s.status){var i=.001*(u.getTime()-s.last_online)>>0;i>=c&&("operator"!=s.user_type?null!=s.conversation_id?o.push(s.conversation_id):r.push(t):(r.push(t),_.push(s.conversation_id)))}n===d&&(e.each(r,function(e,t){a.data.ref_users.child(t).remove()}),e.each(_,function(e,t){a.data.ref_cnv.child(t).remove()}),e.each(o,function(e,t){ylc.is_premium?a.trigger_premium("save_user_data",t,!0,u.getTime()):a.clear_user_data(t)}))})}})},show_welcome_popup:function(){e("#YLC_popup_cnv").addClass("chat-welcome"),e("#YLC_cnv").hide(),e("#YLC_cnv_bottom").hide(),e("#YLC_sidebar_right").hide()},valid_operator:function(e){return ylc.yith_wpv_active?ylc.yith_wpv_active&&ylc.active_vendor.vendor_id===e?!0:ylc.yith_wpv_active&&"0"==ylc.active_vendor.vendor_id&&!ylc.vendor_only_chat?!0:!1:!0}},e.fn[n]=function(){var e;this.data(r)instanceof i||this.data(r,new i(this)),e=this.data(r),e.el=this,e.init()},e(a).ready(function(){e("#YLC_console").ylc_console(),e(t).resize(function(){var a=e(t).height(),s=e(t).width(),i=a-74,n=e("#wpbody-content").width();766>s?(e("#YLC_console").css("height",""),e("#YLC_sidebar_left").css("height",""),e("#YLC_popup_cnv").css("height",""),e("#YLC_sidebar_right").css("height",""),e("#YLC_users").css("height",""),e("#YLC_cnv").css("height",250),e(".yith-live-chat-console-container").width(n-12)):(e("#YLC_console").height(i),e("#YLC_sidebar_left").height(i),e("#YLC_popup_cnv").height(i),e("#YLC_sidebar_right").height(i),e("#YLC_users").height(i-110),e("#YLC_cnv").height(i-e("#YLC_cnv_bottom").innerHeight()-30),e(".yith-live-chat-console-container").width(n-20))}).trigger("resize")})}(jQuery,window,document);